var examType="2",productInfo=null,mobileNumber="",otpNumber="",fullName="",firstName="",lastName="",email="",selectedRegion=null,regionList=[],countryCode="IN",countryMobileCode="+91",productIdGlobal="11920",product_catID=61,defaultCouponApplied=!1,marchantKeyGlobal="qoCStF",userInfo={firstName:"",lastName:"",userType:"",otp:"",mobileNumber:"",guestLevelId:null,countryCode:countryCode},cartInfo={cartType:null,cartMode:null,item_id:"",name:"",price:"",product_type:"",qty:"",quote_id:"",cartId:"",sku:"",productInfo:"books store",enablePg:"true",redirectUrl:""},userCartSummery=null,newUserUuid="",natDatesList=null,selectedNatDate=null,is_app=!1,USE_STAGING=!1,SURL="https://marketplace.vidyamandir.com/api/status/success?source=web",FURL="https://marketplace.vidyamandir.com/api/status/failure?source=web&cb=",CURL="https://marketplace.vidyamandir.com/api/status/cancel?source=web&cb=";let API_MARKET_PLACE="https://marketplace.vidyamandir.com",API_BL="https://bl.vidyamandir.com",API_WP="https://registrations.vidyamandir.com/wp-json/vmc/v1",LARAVEL_API="https://vmcportal.vidyamandir.com";var requestInProcessing=0;function showLoader(){requestInProcessing<=0||(document.getElementById("processing_overlay").hidden=!1)}function hideLoader(){requestInProcessing>0||(document.getElementById("processing_overlay").hidden=!0)}function callApiForValues(e,t,n,o,a=null){requestInProcessing++,showLoader();let l=new XMLHttpRequest;l.open(e,t,!0),l.onreadystatechange=function(){4===this.readyState&&(requestInProcessing--,hideLoader(),200===this.status?n(this.responseText):null==this.response&&0===this.status?console.log("The computer appears to be offline."):console.log("Some error occured in api ",apiName))};for(let e in o)l.setRequestHeader(e,o[e]);l.send(a)}function callMarketPlaceApi(e,t,n,o,a=null){callApiForValues(e,API_MARKET_PLACE+t,n,o,a)}function callBLApi(e,t,n,o,a=null){callApiForValues(e,API_BL+t,n,o,a)}function callBLApiMerito(e,t,n,o,a=null){callApiForValuesMerito(e,API_BL+t,n,o,a)}function callApiForValuesMerito(e,t,n,o,a=null){requestInProcessing++,showLoader();let l=new XMLHttpRequest;l.open(e,t,!0),l.onreadystatechange=function(){4===this.readyState&&(requestInProcessing--,hideLoader(),n(this.responseText))};for(let e in o)l.setRequestHeader(e,o[e]);l.send(a)}function callWPApi(e,t,n,o,a=null){callApiForValues(e,API_WP+t,n,o,a)}function callLaravelApi(e,t,n,o,a=null){callApiForValues(e,LARAVEL_API+t,n,o,a)}function populateFieldsFromUrl(){var e=new URL(window.location.href);["mobile_input","fullname","dob","email","school","select_course","select_center","select_region","select_city","pincode","select_nat_date"].forEach(t=>{var n=e.searchParams.get(t);if(void 0!==n&&null!=n&&""!=n)if(-1!==["select_course","select_center","select_region","select_city","select_nat_date"].indexOf(t))setTimeout((function(){$(`[name="${t}"]`).val(n),$(`[name="${t}"]`).trigger("change"),"select_city"==t&&setTimeout((function(){$(`[name="${t}"]`).val(n)}),1e3)}),3e3);else if("dob"==t){let e=new Date(n);var o=(e.getDate()<10?"0":"")+e.getDate();$("#"+t).val(`${e.getFullYear()}-${e.getMonth()+1}-${o}`)}else $(`[name="${t}"]`).val(n)})}function natTestModeSelected(){var e=document.getElementById("select_test_mode");elCourses=document.getElementById("select_nat_date"),elCourses.selectedIndex=0,document.getElementById("select_course").selectedIndex=0,document.getElementById("select_center").selectedIndex=0,document.getElementById("select_test_mode_error").innerHTML="",e.value?"Offline"==e.value?$(".for_viq_offline").show():$(".for_viq_offline").hide():(document.getElementById("select_test_mode_error").innerHTML="Please Select Test Mode",$(".for_viq_offline").show()),$(".for_viq_offline").find("input,select").val(""),fetchUpcomingNatDates(examType)}function getOfflineCenters(){var e=document.getElementById("select_nat_date").selectedIndex;let t={type:"GET_OFFLINE_TEST_CENTER",postdata:{test_id:(selectedNatDate=0==e?null:natDatesList[e-1]).id}};callLaravelApi("POST","/api/AJAX_DATA",updateOfflineCentre,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(t))}function viqTestCityAddressSelected(){let e=$("#test_center").find(":selected").data("address");$("#test_center_address").html("Address : "+e).css({marginBottom:"1rem"})}function updateOfflineCentre(e){var t=JSON.parse(e);t=t.data;var n=document.getElementById("test_center");for(n.innerHTML="",(o=document.createElement("option")).value="",o.disabled=!0,o.text="Select Offline Test Center *",n.add(o),i=0;i<t.length;i++){var o,a=t[i];(o=document.createElement("option")).value=a.code,o.text=a.value,o.dataset.address=a.address,n.add(o)}n.selectedIndex=0}function changeExamType(){var e=$('[name="select_test_type"]:checked').val();e&&"2"==e?(examType=2,TEST_TYPE="NAT",productIdGlobal=11920,product_catID=61):e&&"6"==e?(examType=6,TEST_TYPE="VINit",$(".for_viq").show(),productIdGlobal=12235,product_catID=64):(examType=3,TEST_TYPE="VIQ",$(".for_viq").show(),productIdGlobal=11992,product_catID=61),$(".for_viq_offline").hide(),couponCodeGlobal=TEST_TYPE+"999",couponCodeSecondary=TEST_TYPE+"299",couponCodeTestdateSpecific=TEST_TYPE+"299",couponCodeforNEET=TEST_TYPE+"499",$(".for_viq, .for_viq_offline").find("input,select").val("")}function pageLoaded(){let e=window.location.search,t=new URLSearchParams(e);t.has("appstudentid")&&""!=t.get("appstudentid")?(is_app=!0,$("#is_app").addClass("d-none")):($("#is_app").removeClass("d-none"),is_app=!1),t.has("special_link")&&""!=t.get("special_link")?"VMCDMRC"!=t.get("special_link")&&"vmcdmrc"!=t.get("special_link")||(is_special=!0,special_coupon="VMCDMRC"):is_special=!1,$("body").find("select").val(""),defaultCouponApplied=!1,changeExamType(),fetchProductInfo(),getMarketPlaceRegionsForCountry(),populateFieldsFromUrl()}$('[name="select_test_type"]').change(pageLoaded),$((function(){let e=window.location.search,t=new URLSearchParams(e),n=["viq","nat"],o={viq:3,nat:2};if(t.has("exam_type")){let e=t.get("exam_type").toLowerCase();n.includes(e)?($(`[name="select_test_type"][value="${o[e]}"]`).prop("checked",!0),$(`#${e}_tab`).trigger("click")):($('[name="select_test_type"][value="3"]').prop("checked",!0),$("#viq_tab").trigger("click"))}else $('[name="select_test_type"][value="3"]').prop("checked",!0),$("#viq_tab").trigger("click");pageLoaded()}));var fetchUpcomingNatDates=function(e){let t="online",n=document.getElementById("select_test_mode");n.value&&(t=n.value),callBLApi("GET",`/getUpcomingNatDates?type=${e}&test_mode=${t}`,fetchUpcomingNatDatesSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},null)},fetchUpcomingNatDatesSuccess=function(e){var t=JSON.parse(e);if(t.error)return document.getElementById("select_nat_date").hidden=!0,document.getElementById("select_nat_date").style.height=0,document.getElementById("select_nat_date_error").hidden=!0,void(document.getElementById("select_nat_date_error").style.height=0);null!=t.response&&null!=t.response&&t.response.length>0?(document.getElementById("select_nat_date").hidden=!1,document.getElementById("select_nat_date").style.height=38,document.getElementById("select_nat_date").setAttribute("style","height:38px"),document.getElementById("select_nat_date_error").hidden=!1,document.getElementById("select_nat_date_error").style.height=20,prepareNatDateOptionsSelection(natDatesList=t.response)):(document.getElementById("select_nat_date").hidden=!0,document.getElementById("select_nat_date").style.height=0,document.getElementById("select_nat_date_error").hidden=!0,document.getElementById("select_nat_date_error").style.height=0)};function prepareNatDateOptionsSelection(e){(t=document.getElementById("select_nat_date")).innerHTML="",t.innerHTML="<option value='' selected = ''>Please select Test *</option>";var t,n=0;for(l=0;l<e.length;l++){var o=e[l],a=document.createElement("option");a.text=o.testName,t.add(a),1!=o.isDefault&&1!=o.isDefault&&"1"!=o.isDefault||(n=l)}0!=n?((t=document.getElementById("select_nat_date")).selectedIndex=n+1,natDateOptionSelected()):(t=document.getElementById("select_nat_date")).selectedIndex=0;var l,d=document.getElementById("select_nat_date"),r="",i=["month","January","February","March","April","May","June","July","August","September","October","November","December"];for(l=1;l<d.length;l++){var c=d.options[l].text.split("-")[0],s=d.options[l].text.split("-")[1],u=d.options[l].text.split("-")[2];r=r+'<span class="upcoming-dates">'+c+" "+i[prependZero(s)]+" "+u+"</span>"}const m=document.getElementById("test-dates");void 0!==m&&null!=m&&(m.innerHTML='<span class="Dates-Holder">'+r+"</span>")}function prependZero(e){return e<=9?("0"+e).slice(-1):e}function formatDate(e){var t=e.split("-");return[t[2],t[1],t[0]].join("-")}function natDateOptionSelected(){let e=!1;if(!document.getElementById("select_test_mode").value)return document.getElementById("select_nat_date").value="",void(document.getElementById("select_test_mode_error").innerHTML="Please Select Test Mode");e=!0;var t=document.getElementById("select_nat_date").selectedIndex;selectedNatDate=0==t?null:natDatesList[t-1];let n={type:"GET_CLASS_AGAINST_TEST_REGISTRATION",postdata:{exam_type:examType,test_id:selectedNatDate.id}};callLaravelApi("POST","/api/AJAX_DATA",updateCoursesOptions,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(n)),getOfflineCenters();var o=document.getElementById("select_test_mode");is_app?("Online"!=o.value&&"online"!=o.value||400!=selectedNatDate.id&&401!=selectedNatDate.id&&421!=selectedNatDate.id&&422!=selectedNatDate.id&&423!=selectedNatDate.id&&425!=selectedNatDate.id&&426!=selectedNatDate.id||(couponCodeGlobal="VIQPLUS99",applyCouponWithCouponCode(couponCodeGlobal),document.getElementById("couponCode").disabled=dalse,document.getElementById("couponCode").value=couponCodeGlobal),"Offline"!=o.value&&"offline"!=o.value||396!=selectedNatDate.id&&400!=selectedNatDate.id&&421!=selectedNatDate.id&&424!=selectedNatDate.id&&425!=selectedNatDate.id||(couponCodeGlobal="VIQPLUS49",applyCouponWithCouponCode(couponCodeGlobal),document.getElementById("couponCode").disabled=dalse,document.getElementById("couponCode").value=couponCodeGlobal)):is_special?("Online"!=o.value&&"online"!=o.value||400!=selectedNatDate.id&&401!=selectedNatDate.id&&421!=selectedNatDate.id&&422!=selectedNatDate.id&&423!=selectedNatDate.id&&425!=selectedNatDate.id&&426!=selectedNatDate.id||(couponCodeGlobal="VMCDMRC",applyCouponWithCouponCode(couponCodeGlobal),document.getElementById("couponCode").disabled=dalse,document.getElementById("couponCode").value=couponCodeGlobal),"Offline"!=o.value&&"offline"!=o.value||396!=selectedNatDate.id&&400!=selectedNatDate.id&&421!=selectedNatDate.id&&424!=selectedNatDate.id&&425!=selectedNatDate.id||(couponCodeGlobal="VMCDMRC",applyCouponWithCouponCode(couponCodeGlobal),document.getElementById("couponCode").disabled=dalse,document.getElementById("couponCode").value=couponCodeGlobal)):("Online"!=o.value&&"online"!=o.value||400!=selectedNatDate.id&&401!=selectedNatDate.id&&421!=selectedNatDate.id&&422!=selectedNatDate.id&&423!=selectedNatDate.id&&425!=selectedNatDate.id&&426!=selectedNatDate.id||(couponCodeGlobal="VIQPLUS99",applyCouponWithCouponCode(couponCodeGlobal),document.getElementById("couponCode").disabled=dalse,document.getElementById("couponCode").value=couponCodeGlobal),"Offline"!=o.value&&"offline"!=o.value||396!=selectedNatDate.id&&400!=selectedNatDate.id&&421!=selectedNatDate.id&&424!=selectedNatDate.id&&425!=selectedNatDate.id||(couponCodeGlobal="VIQPLUS49",applyCouponWithCouponCode(couponCodeGlobal),document.getElementById("couponCode").disabled=dalse,document.getElementById("couponCode").value=couponCodeGlobal)),changePriceCoupon()}function changePriceCoupon(){document.getElementById("select_course");var e=document.getElementById("select_nat_date").selectedIndex,t=natDatesList[e-1];new Date("2023-08-15"),new Date;let n=document.getElementById("select_center").value;n=+n;var o=window.location.search,a=new URLSearchParams(o);a.has("centre_code")&&a.get("centre_code");var l=document.getElementById("select_test_mode");is_app?"Online"==l.value||"online"==l.value?(400==t.id||421==t.id||422==t.id||423==t.id||425==t.id||426==t.id?document.getElementById("couponCode").value="VIQPLUS99":400!=t.id&&421!=t.id&&422!=t.id&&423!=t.id&&425!=t.id&&426!=t.id&&400!=t.id&&401!=t.id||176!=n&&178!=n&&121!=n&&174!=n&&177!=n&&170!=n&&127!=n&&128!=n&&134!=n&&136!=n&&169!=n&&145!=n&&147!=n&&175!=n&&182!=n&&179!=n&&180!=n&&181!=n&&154!=n&&156!=n&&155!=n&&160!=n&&164!=n&&117!=n&&123!=n&&141!=n&&144!=n&&148!=n&&150!=n&&159!=n&&130!=n&&161!=n&&172!=n||(document.getElementById("couponCode").value="VIQPLUS99"),document.getElementById("btn_remove_coupon").disabled=!0,applyCoupon()):("Offline"!=l.value&&"offline"!=l.value||396!=t.id&&400!=t.id&&421!=t.id&&424!=t.id&&425!=t.id||(document.getElementById("couponCode").value="VIQPLUS49"),document.getElementById("btn_remove_coupon").disabled=!0,applyCoupon()):is_special?"Online"==l.value||"online"==l.value?(400==t.id||421==t.id||422==t.id||423==t.id||425==t.id||426==t.id?document.getElementById("couponCode").value="VMCDMRC":400!=t.id&&421!=t.id&&422!=t.id&&423!=t.id&&425!=t.id&&426!=t.id&&400!=t.id&&401!=t.id||176!=n&&178!=n&&121!=n&&174!=n&&177!=n&&170!=n&&127!=n&&128!=n&&134!=n&&136!=n&&169!=n&&145!=n&&147!=n&&175!=n&&182!=n&&179!=n&&180!=n&&181!=n&&154!=n&&156!=n&&155!=n&&160!=n&&164!=n&&117!=n&&123!=n&&141!=n&&144!=n&&148!=n&&150!=n&&159!=n&&130!=n&&161!=n&&172!=n||(document.getElementById("couponCode").value="VMCDMRC"),document.getElementById("btn_remove_coupon").disabled=!0,applyCoupon()):("Offline"!=l.value&&"offline"!=l.value||396!=t.id&&400!=t.id&&421!=t.id&&424!=t.id&&425!=t.id||(document.getElementById("couponCode").value="VMCDMRC"),document.getElementById("btn_remove_coupon").disabled=!0,applyCoupon()):"Online"==l.value||"online"==l.value?(400==t.id||421==t.id||422==t.id||423==t.id||425==t.id||426==t.id?document.getElementById("couponCode").value="VIQPLUS99":400!=t.id&&421!=t.id&&422!=t.id&&423!=t.id&&425!=t.id&&426!=t.id&&400!=t.id&&401!=t.id||176!=n&&178!=n&&121!=n&&174!=n&&177!=n&&170!=n&&127!=n&&128!=n&&134!=n&&136!=n&&169!=n&&145!=n&&147!=n&&175!=n&&182!=n&&179!=n&&180!=n&&181!=n&&154!=n&&156!=n&&155!=n&&160!=n&&164!=n&&117!=n&&123!=n&&141!=n&&144!=n&&148!=n&&150!=n&&159!=n&&130!=n&&161!=n&&172!=n||(document.getElementById("couponCode").value="VIQPLUS99"),document.getElementById("btn_remove_coupon").disabled=!0,applyCoupon()):("Offline"!=l.value&&"offline"!=l.value||396!=t.id&&400!=t.id&&421!=t.id&&424!=t.id&&425!=t.id||(document.getElementById("couponCode").value="VIQPLUS49"),document.getElementById("btn_remove_coupon").disabled=!0,applyCoupon())}function updateStateOptions(e){var t=JSON.parse(e).available_regions,n=document.getElementById("select_region");for(i=0;i<t.length;i++){var o=t[i],a=document.createElement("option");a.text=o.default_name,n.add(a)}n.selectedIndex=0}$("#select_course").on("change",(function(){})),document.getElementById("select_center").onchange=function(){let e={type:"GET_STATE_AGAINST_CENTER",center_code:document.getElementById("select_center").value};callLaravelApi("POST","/api/statedatacenterwisetest",updateStateOptions,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(e)),changePriceCoupon()},document.getElementById("select_center").onchange=function(){let e={type:"GET_STATE_AGAINST_CENTER",center_code:document.getElementById("select_center").value};callLaravelApi("POST","/api/statedatacenterwisetest",updateStateOptions,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(e)),changePriceCoupon()},document.getElementById("select_course").onchange=function(){var e=document.getElementById("select_course");let t={type:"GET_CENTER_AGAINST_CLASS_REGISTRATION",postdata:{exam_type:examType,registration_code:e.value,test_id:get_exam_test_id()}};callLaravelApi("POST","/api/AJAX_DATA",updateCentersOptions,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(t)),changePriceCoupon()};var fetchProductInfo=function(){callMarketPlaceApi("GET",`/rest/api/v2/getProductList?start=0&end=20&cat=${product_catID}&classLevelId=undefined&productId=${productIdGlobal}`,fetchProductInfoSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"})};function fetchProductInfoSuccess(e){var t=JSON.parse(e);t.error?alert(t.error.errorMessage):(productInfo=t.result.docs[0],addToCart())}function addToCart(){var e={items:[{id:productInfo.id,skuCode:productInfo.sku,configurable_item_options:productInfo.configurable_item_options,couponCode:"",uuid:null,quote_id:"",count:1,schoolName:""}]};callMarketPlaceApi("POST","/rest/api/v2/cart/addToCart",addToCartSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(e))}function addToCartSuccess(e){var t=JSON.parse(e);t.error?alert(t.error.errorMessage):(cartInfo.item_id=t.data[0].response.data.item_id,cartInfo.name=t.data[0].response.data.name,cartInfo.price=t.data[0].response.data.price,cartInfo.product_type=t.data[0].response.data.product_type,cartInfo.qty=t.data[0].response.data.qty,cartInfo.quote_id=t.data[0].response.data.quote_id,cartInfo.cartId=t.data[0].response.data.quote_id,cartInfo.sku=t.data[0].response.data.sku,getCart(cartInfo.cartId))}function updateUIAsPerCartInfo(){var e="",t="";null!=userCartSummery.list[0].discount&&null!=userCartSummery.list[0].discount?e='<span style="font-size: 15px; text-decoration: line-through; text-decoration-color: red;">&#8377 999</span><span style="font-size: 24px; margin-left: 10px;">&#8377 '+parseInt(userCartSummery.total_amount)+" Only</span>":(is_special?t=49:2==examType?t=499:3==examType&&(t=49),e='<span style="font-size: 15px; text-decoration: line-through; text-decoration-color: red;">&#8377 999</span><span style="font-size: 22px; font-family:cera bold; margin-left: 10px; color:#fecc00">&#8377 '+t+" Only</span>");var n,o=document.getElementsByClassName("registration_fee");for(n=0;n<o.length;n++)o[n].innerHTML=e;document.getElementById("registration_fee").innerHTML=e}function getCart(e){callMarketPlaceApi("GET","/rest/api/v1/cart/getCart/0?quote_id="+e,getCartSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"})}function getCartSuccess(e){var t=JSON.parse(e);t.error?alert(t.error.errorMessage):(userCartSummery=t.data,updateUIAsPerCartInfo(),0==defaultCouponApplied&&(defaultCouponApplied=!0,is_app?(3==examType&&(document.getElementById("couponCode").value="VIQPLUS99"),2==examType&&(document.getElementById("couponCode").value="NAT199")):is_special?(2==examType&&(document.getElementById("couponCode").value="VMCDMRC"),3==examType&&(document.getElementById("couponCode").value="VMCDMRC")):document.getElementById("couponCode").value=2==examType?"NAT499":"VIQPLUS99",applyCoupon()))}var couponAppliedSuccessfullyFlag=!1;function couponCodeAppliedSuccessfully(){couponAppliedSuccessfullyFlag=!0,document.getElementById("couponcode_status").innerHTML='<img id="couponcode_status_img" width="20" height="20" alt="success" src="https://www.vidyamandir.com/img/coupon_apply_success.png"/><span id="couponcode_status_msg" style="margin-left:10px;font-size:12px;color:#fff">Coupon code applied successfully.</span>'}function couponCodeApplyError(e){let t='<img id="couponcode_status_img" width="20" height="20" alt="error" src="https://www.vidyamandir.com/img/coupon_apply_error.png"/><span id="couponcode_status_msg" style="margin-left:10px;font-size:12px">'+e+"</span>";var n=document.getElementById("select_course").value.trim();document.getElementById("couponcode_status").innerHTML="23"==n||"13"==n||"63"==n?t+' \t\t<button  \t\t\tonclick="changeCouponCode()" \t\t\tstyle="background: green;color: #fff;outline: 0;border: 0;padding: 4px 8px;border-radius: 4px;font-size: 12px;"> \t\t\tClick here to apply '+couponCodeforNEET+"</button>":t+' \t\t<button  \t\t\tonclick="applyExistingCode()" \t\t\tstyle="background: green;color: #fff;outline: 0;border: 0;padding: 4px 8px;border-radius: 4px;font-size: 12px;"> \t\t\tClick here to apply '+couponCodeSecondary+"</button>"}function couponCodeRemoved(){couponAppliedSuccessfullyFlag=!1,document.getElementById("couponcode_status").innerHTML=""}function updateCouponCodeInUI(){document.getElementById("couponCode").value=couponCodeGlobal,null==couponCodeGlobal||null==couponCodeGlobal||0==couponCodeGlobal.length?(document.getElementById("couponCode").disabled=!1,document.getElementById("couponCode").focus(),document.getElementById("couponCode").select(),document.getElementById("btn_apply_coupon").hidden=!1,document.getElementById("btn_remove_coupon").hidden=!0):(document.getElementById("couponCode").disabled=!0,document.getElementById("btn_apply_coupon").hidden=!0,document.getElementById("btn_remove_coupon").hidden=!1)}function applyCouponSuccess(e){var t=JSON.parse(e);if(t.response.error)return couponAppliedSuccessfullyFlag=!1,couponCodeApplyError(t.response.error.errorMessage),void getCart(cartInfo.cartId);couponCodeAppliedSuccessfully(),updateCouponCodeInUI(),getCart(cartInfo.cartId)}function applyCouponWithCouponCode(e){var t={quote_id:userCartSummery.cart_id,coupon_code:e,sku:userCartSummery.list[0].parentSku,product_id:userCartSummery.list[0].child_product_id?userCartSummery.list[0].child_product_id:userCartSummery.list[0].product_id};callMarketPlaceApi("POST","/rest/api/v2/applyCouponCode",applyCouponSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(t))}function applyCoupon(){couponCodeGlobal=document.getElementById("couponCode").value.trim(),document.getElementById("couponCode_error").innerHTML="",applyCouponWithCouponCode(couponCodeGlobal)}function applyExistingCode(){0==document.getElementById("select_nat_date").selectedIndex&&(document.getElementById("couponCode").value=couponCodeSecondary,applyCoupon())}function changeCouponCode(){var e=document.getElementById("select_course").value.trim();"74"==e||"64"==e?0==document.getElementById("select_nat_date").selectedIndex&&applyCoupon():applyExistingCode()}function removeCoupon(){callMarketPlaceApi("POST","/rest/api/v2/removeCouponCode?quote_id="+userCartSummery.cart_id,removeCouponSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify({}))}function removeCouponSuccess(e){var t=JSON.parse(e);t.error?alert(t.error.errorMessage):(couponCodeGlobal="",couponCodeRemoved(),updateCouponCodeInUI(),getCart(cartInfo.cartId))}function getMobileValidationRules(){callBLApi("GET","/getMobileValidationRules",getMobileValidationRulesSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},null)}function getMobileValidationRulesSuccess(){var e=JSON.parse(responseText);e.error&&alert(e.error.errorMessage)}function sendMobileVerificationCode(){if(null!=(mobileNumber=document.getElementById("mobile_input").value.trim())&&null!=mobileNumber&&0!=mobileNumber.length){if(0==/^[6-9][0-9]{9}$/.test(String(mobileNumber).toLowerCase()))return document.getElementById("mobile_number_error").innerHTML="Please enter a valid mobile number",!0;document.getElementById("mobile_number_error").innerHTML="",document.getElementById("mobile_number_otp_error").innerHTML="",callBLApi("GET","/user/sendMobileVerificationCode/"+mobileNumber+"?countryCode="+countryCode,sendMobileVerificationCodeSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},null)}else document.getElementById("mobile_number_error").innerHTML="Please enter student's mobile number"}function sendMobileVerificationCodeSuccess(e){var t=JSON.parse(e);t.error?alert(t.error.errorMessage):(t.code&&(document.getElementById("mobile_number_otp_error").innerHTML="Didn't receive OTP? Use "+t.code+" as OTP"),toggleMobileAndOTPDiv())}function changeMobileNumber(){toggleMobileAndOTPDiv()}function toggleMobileAndOTPDiv(){var e=document.getElementById("mobile_number");e.classList.contains("height-0")?e.classList.remove("height-0"):e.classList.add("height-0");var t=document.getElementById("mobile_number_otp");t.classList.contains("height-0")?t.classList.remove("height-0"):t.classList.add("height-0")}function verifyOTPSuccess(e){var t=JSON.parse(e);t.error?alert(t.error.errorMessage):addToCart()}function verifyOTP(){if(null!=(otpNumber=document.getElementById("mobile_otp_input").value.trim())&&null!=otpNumber&&0!=otpNumber.length){document.getElementById("mobile_number_error").innerHTML="",document.getElementById("mobile_number_otp_error").innerHTML="";var e={mobileNo:mobileNumber,verifyCode:otpNumber,verifyFor:"Mobile",countryCode:countryCode};callBLApi("POST","/user/isCodeValidForUser",verifyOTPSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(e))}else document.getElementById("mobile_number_otp_error").innerHTML="Please enter OTP sent on student's mobile number"}function regionOptionSelected(){var e=document.getElementById("select_region").selectedIndex;selectedRegion=0==e?null:regionList[e-1]}function prepareRegionOptionsSelection(e){var t=document.getElementById("select_region");for(i=0;i<e.length;i++){var n=e[i];document.createElement("option").text=n.name}t.selectedIndex=0}function getMarketPlaceRegionsForCountrySuccess(e){var t=JSON.parse(e);t.error?alert(t.error.errorMessage):null!=(regionList=t.available_regions)&&null!=regionList.length&&0!=regionList.length?prepareRegionOptionsSelection(t.available_regions):alert("States can't be fetched for India. Please try again.")}function getMarketPlaceRegionsForCountry(){callMarketPlaceApi("GET","/rest/V1/directory/countries/"+countryCode,getMarketPlaceRegionsForCountrySuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"})}function registerGuestUserForPurchaseSuccess(e){var t=JSON.parse(e);if(t.error)return alert(t.error.errorMessage),void(document.getElementById("proceed_to_pay").disabled=!1);newUserUuid=t.user.uuid,updateContactUserDetails()}function registerGuestUserForPurchase(e){var t=JSON.parse(e);if(t.error)alert(t.error.errorMessage);else{otpNumber=t.code;var n=(fullName=document.getElementById("fullname").value.trim()).split(" ");n.length>1?(firstName=n.slice(0,n.length-1).join(" "),lastName=n[n.length-1]):(firstName=fullName,lastName=""),emailId=document.getElementById("email").value.trim();var o={user:{firstName:firstName,lastName:lastName,userType:"M",otp:otpNumber,mobileNumber:mobileNumber,guestLevelId:null,countryCode:countryCode}};callBLApi("POST","/user/registerGuestUserForPurchase",registerGuestUserForPurchaseSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(o))}}function updateContactUserDetailsSuccess(e){document.getElementById("proceed_to_pay").disabled=!1;var t=JSON.parse(e);t.error?alert(t.error.errorMessage):(cartInfo.firstName=firstName,cartInfo.lastName=lastName,cartInfo.emailId=emailId,cartInfo.mobileNumber=mobileNumber,calculateHashValuesForPG())}function updateContactUserDetails(){if(null!=natDatesList&&null==selectedNatDate)return document.getElementById("select_nat_date_error").innerHTML="Please select exam Date",!0;document.getElementById("select_nat_date_error").innerHTML="";var e=window.location.search,t=new URLSearchParams(e),n="",o="",a="",l="",d="";t.has("utm_campaign")&&(n=t.get("utm_campaign")),t.has("utm_source")&&(o=t.get("utm_source")),t.has("utm_medium")&&(a=t.get("utm_medium")),t.has("utm_term")&&(l=t.get("utm_term")),t.has("utm_content")&&(d=t.get("utm_content"));let r=null;t.has("appstudentid")&&(r=t.get("appstudentid"));var i=null!=selectedNatDate?selectedNatDate.id:"",c={params:{firstName:firstName,lastName:lastName,email:emailId,mobile:mobileNumber,pincode:null,addressLine1:null,addressLine2:null,city:null,state:selectedRegion.state_code,roll_number:null,uuid:newUserUuid,countryCode:countryCode,quoteId:cartInfo.cartId,preferedExamDate:i,source_url:window.location.href,utm_content:d,utm_term:l,utm_medium:a,utm_campaign:n,utm_source:o,name:document.getElementById("fullname").value,course_code:document.getElementById("select_course").value,center_code:document.getElementById("select_center").value,test_date:selectedNatDate.testDate,state_name:document.getElementById("select_region").value,appstudentid:r,exam_type:examType,test_type:document.getElementById("select_test_mode").value,test_center:document.getElementById("test_center").value}};callMarketPlaceApi("POST","/rest/api/v1/updateUserContactDetails",updateContactUserDetailsSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(c))}function calculateHashValuesSuccess(e){document.getElementById("proceed_to_pay").disabled=!1;var t=JSON.parse(e);t.error?alert(t.error.errorMessage):(cartInfo.payableAmount=t.payableAmount,cartInfo.pgCharge=t.pgCharges,cartInfo.basePgCharges=t.basePgCharges,cartInfo.taxDetails=t.taxDetails,cartInfo.paymentHash=t.payment_hash,cartInfo.key=null==t.key||null==t.key||""==t.key?$scope.marchantKeyGlobal:t.key,cartInfo.txnId=t.txnid,cartInfo.enablePg=t.enablePg.toString(),cartInfo.redirectUrl=t.redirectUrl,callWPApi("PUT","/nat_registrations/"+newUserUuid,nat_registrations_success,{"Content-Type":"application/json"},JSON.stringify({name:document.getElementById("fullname").value,course:document.getElementById("select_course").value,center:document.getElementById("select_center").value})))}function nat_registrations_success(e){if("true"==cartInfo.enablePg){let e={name:document.getElementById("fullname").value,course:document.getElementById("select_course").value,center:document.getElementById("select_center").value,email:document.getElementById("email").value.trim(),phone:document.getElementById("mobile_input").value.trim(),select_test_mode:document.getElementById("select_test_mode").value.trim(),exam_test_id:get_exam_test_id(),txnid:cartInfo.txnId,state:document.getElementById("select_region").value.trim(),url:window.location.href,source:"nat-national-admission-test.html"};callBLApiMerito("POST","/user/sendDataMerito",lead_merito_success,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(e))}else window.location=cartInfo.redirectUrl+"&sendadmitcard=1"}function lead_merito_success(e){startPayment()}function getPaymentSuccessParams(){return"name="+encodeURIComponent(document.getElementById("fullname").value)+"&course="+encodeURIComponent(document.getElementById("select_course").value)+"&center_code="+encodeURIComponent(document.getElementById("select_center").value)}function calculateHashValuesForPG(){var e={cardmode:cartInfo.cartMode,cartId:cartInfo.cartId,paymentmode:"debitcard",placeOrder:!0,productinfo:cartInfo.productInfo,platform:"Web",is_shippable:!1};callMarketPlaceApi("POST","/rest/api/v1/payment/order/hash",calculateHashValuesSuccess,{"Content-Type":"application/json",SupportedApiVersion:"1"},JSON.stringify(e))}function createAndAddElementWithTypeNameAndValue(e,t,n,o){var a=document.createElement("input");a.setAttribute("type",e),a.setAttribute("name",t),a.setAttribute("value",n),o.appendChild(a)}function startPayment(){var e=document.createElement("form");e.setAttribute("action","https://secure.payu.in/_payment"),e.setAttribute("method","post"),this.createAndAddElementWithTypeNameAndValue("hidden","key",cartInfo.key,e),this.createAndAddElementWithTypeNameAndValue("hidden","amount",cartInfo.payableAmount,e),this.createAndAddElementWithTypeNameAndValue("hidden","txnid",cartInfo.txnId,e),this.createAndAddElementWithTypeNameAndValue("hidden","productinfo",cartInfo.productInfo,e),this.createAndAddElementWithTypeNameAndValue("hidden","firstname",cartInfo.firstName,e),this.createAndAddElementWithTypeNameAndValue("hidden","phone",cartInfo.mobileNumber,e),this.createAndAddElementWithTypeNameAndValue("hidden","email",cartInfo.emailId,e),this.createAndAddElementWithTypeNameAndValue("hidden","surl",SURL+"&"+getPaymentSuccessParams(),e),this.createAndAddElementWithTypeNameAndValue("hidden","furl",FURL+btoa(window.location.href),e),this.createAndAddElementWithTypeNameAndValue("hidden","curl",CURL+btoa(window.location.href),e),this.createAndAddElementWithTypeNameAndValue("hidden","udf1","",e),this.createAndAddElementWithTypeNameAndValue("hidden","udf2","",e),this.createAndAddElementWithTypeNameAndValue("hidden","udf3","",e),this.createAndAddElementWithTypeNameAndValue("hidden","hash",cartInfo.paymentHash,e),document.getElementsByTagName("body")[0].appendChild(e),e.submit()}function toggleMobileVerifyAndStudent(){var e=document.getElementById("mobile_verification_div");e.classList.contains("height-0")?e.classList.remove("height-0"):e.classList.add("height-0");var t=document.getElementById("user_and_payment_info");t.classList.contains("height-0")?t.classList.remove("height-0"):t.classList.add("height-0")}function validateFields(){if(null==(mobileNumber=document.getElementById("mobile_input").value.trim())||null==mobileNumber||0==mobileNumber.length)return document.getElementById("mobile_error").innerHTML="Please enter Student's Phone Number",!0;if(!1===/^[6-9][0-9]{9}$/.test(String(mobileNumber).toLowerCase()))return document.getElementById("mobile_error").innerHTML="Please enter a valid 10-digit mobile number",!0;if(document.getElementById("mobile_error").innerHTML="",null==(fullName=document.getElementById("fullname").value.trim())||null==fullName||0==fullName.length)return document.getElementById("fullname_error").innerHTML="Please enter student's full name",!0;document.getElementById("fullname_error").innerHTML="";var e=document.getElementById("select_course").value.trim();if(null==e||null==e||"Select Course"==e||0==e.length)return document.getElementById("select_course_error").innerHTML="Please select course",!0;document.getElementById("select_course_error").innerHTML="";var t=document.getElementById("select_center").value.trim();if(null==t||null==t||"Preferred Center"==t||0==t.length)return document.getElementById("select_center_error").innerHTML="Please select center",!0;if(document.getElementById("select_center_error").innerHTML="",emailId=document.getElementById("email").value.trim(),null==emailId||null==emailId||0==emailId.length)return document.getElementById("email_error").innerHTML="Please enter student's email id",!0;if(0==/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(emailId).toLowerCase()))return document.getElementById("email_error").innerHTML="Please enter a valid email id",!0;if(document.getElementById("email_error").innerHTML="",null!=natDatesList&&null==selectedNatDate)return document.getElementById("select_nat_date_error").innerHTML="Please select exam Date",!0;if(document.getElementById("select_nat_date_error").innerHTML="",document.getElementById("select_region").value.trim(),null==selectedRegion)return document.getElementById("select_region_error").innerHTML="Please select student's state",!0;document.getElementById("select_region_error").innerHTML="";var n=document.getElementById("couponCode").value.trim();if(null==n||null==n||0==n.length)return couponCodeApplyError("Please enter coupon code"),!0;if(!couponAppliedSuccessfullyFlag)return couponCodeApplyError("Please enter valid coupon code"),!0;if(document.getElementById("couponCode_error").innerHTML="",2==examType){var o=document.getElementById("select_test_mode").value.trim();if(null==o||null==o||0==o.length)return document.getElementById("select_test_mode_error").innerHTML="Please Select Test Mode",!0;if(document.getElementById("select_test_mode_error").innerHTML="","Offline"==o){var a=document.getElementById("test_center").value.trim();if(null==a||null==a||0==a.length)return document.getElementById("test_center_error").innerHTML="Please Select Offline Test Center",!0;document.getElementById("test_center_error").innerHTML=""}}return!1}function get_exam_test_id(){let e=document.getElementById("select_nat_date").selectedIndex;return 0!=e&&(selectedNatDate=natDatesList[e-1]).id}function startNATRegistrationProcess(){if(validateFields())return;var e=document.getElementById("fullname").value.trim(),t=document.getElementById("email").value.trim(),n=document.getElementById("mobile_input").value.trim();let o=get_exam_test_id(),a=document.getElementById("select_center").value.trim(),l=document.getElementById("select_course").value.trim();callWPApi("GET","/check_duplicate_nat_registrations?student_name="+e+"&student_dob=&student_email="+t+"&student_phone="+n+"&amount="+userCartSummery.total_amount+"&exam_test_id="+o+"&select_center="+a+"&select_course="+l+"&exam_type="+examType,check_duplicate,{},null)}function check_duplicate(e){const t=JSON.parse(e);if(document.getElementById("select_center").value.trim(),200!=t.status){if(400==t.status)return document.getElementById("couponCode").value=`${TEST_TYPE}${t.amount}`,applyCoupon(),setTimeout(callapifunc(),15e3),document.getElementById("duplicate_record_error").innerHTML=t.message,!1}else{document.getElementById("proceed_to_pay").disabled=!0;var n="NAT";3==examType&&(n="VIQ"),callBLApi("GET","/user/sendMobileVerificationCode/"+mobileNumber+"?countryCode="+countryCode+"&registerFor="+n,registerGuestUserForPurchase,{"Content-Type":"application/json",SupportedApiVersion:"1"},null)}}function callapifunc(){document.getElementById("proceed_to_pay").disabled=!0;var e="NAT";3==examType&&(e="VIQ"),callBLApi("GET","/user/sendMobileVerificationCode/"+mobileNumber+"?countryCode="+countryCode+"&registerFor="+e,registerGuestUserForPurchase,{"Content-Type":"application/json",SupportedApiVersion:"1"},null)}function registerNowPressed(){$(window).scrollTop($("#registration_div").offset().top-200),document.getElementById("mobile_input").focus(),document.getElementById("mobile_input").select()}function updateCoursesOptions(e){var t=JSON.parse(e);console.log(t);var n=document.getElementById("select_course");for(document.getElementById("select_test_mode"),n.innerHTML="",(o=document.createElement("option")).value="",o.disabled=!0,o.text="Select Course *",n.add(o),i=0;i<t.length;i++){var o,a=t[i];(o=document.createElement("option")).value=a.code,o.text=a.value,n.add(o)}n.selectedIndex=0}function updateCentersOptions(e){var t=JSON.parse(e);console.log(t);var n=document.getElementById("select_center");for(document.getElementById("select_course").value.trim(),document.getElementById("select_nat_date").value.trim(),document.getElementById("select_test_mode"),n.innerHTML="",(o=document.createElement("option")).value="",o.disabled=!0,o.text="Select Study Center *",n.add(o),console.log(t.length),i=0;i<t.length;i++){var o,a=t[i];(o=document.createElement("option")).value=a.code,o.text=a.value,n.add(o)}n.selectedIndex=0}function updateStatesOptions(e){stateListArr=JSON.parse(e),console.log(stateListArr);var t=document.getElementById("select_region");for(i=0;i<stateListArr.length;i++){var n=stateListArr[i],o=document.createElement("option");o.value=n.code,o.text=n.value,t.add(o)}t.selectedIndex=0}stateListArr=null;var cityListArr=null;function updateCitiesOptions(e){cityListArr=JSON.parse(e);var t=document.getElementById("select_city");for(o=t.options.length-1;i>=1;i--)t.remove(i);for(console.log(selectedRegion),i=0;i<cityListArr.length;i++){var n=cityListArr[i],a=document.createElement("option");a.value=n.code,a.text=n.value,t.add(a)}t.selectedIndex=0}